# Development environment values for linktree

environment: development

backend:
  enabled: true
  replicaCount: 1

  image:
    repository: linktree-backend
    pullPolicy: Never
    tag: "local"

  service:
    type: ClusterIP
    port: 8000

  config:
    nodeEnv: development
    corsOrigin: "http://localhost:3000,http://localhost:5173,http://linktree-dev.local"
    port: 8000

  # Secret único contendo todas as credenciais
  secretName: "linktree-secrets"

  database:
    host: "linktree-dev-postgresql-rw"
    port: "5432"
    database: "linktree_db"

  resources:
    limits:
      cpu: 300m
      memory: 384Mi
    requests:
      cpu: 100m
      memory: 128Mi

  autoscaling:
    enabled: false

  # ============================================================================
  # ARGO ROLLOUTS - BLUEGREEN DEPLOYMENT (DEV)
  # ============================================================================
  # Configuração para estratégia BlueGreen em ambiente de desenvolvimento
  # - Duas versões completas rodando simultaneamente (Blue e Green)
  # - Promoção manual obrigatória (autoPromotionEnabled: false)
  # - Service preview permite testar nova versão antes de promover
  # - Após promoção, service active aponta para nova versão
  #
  # Comandos úteis:
  #   Ver status: kubectl argo rollouts get rollout linktree-dev-backend -n dev
  #   Testar preview: kubectl port-forward svc/linktree-dev-backend-preview 8001:8000 -n dev
  #   Promover: kubectl argo rollouts promote linktree-dev-backend -n dev
  #   Abortar: kubectl argo rollouts abort linktree-dev-backend -n dev
  # ============================================================================
  rollout:
    enabled: true
    strategy: blueGreen

    blueGreen:
      # Tempo de espera antes de deletar versão antiga após promoção
      scaleDownDelaySeconds: 30

      # Anti-affinity desabilitado (cluster dev tem apenas 1 node)
      antiAffinity: false

frontend:
  enabled: true
  replicaCount: 1

  image:
    repository: linktree-frontend
    pullPolicy: Never
    tag: "local"

  service:
    type: ClusterIP
    port: 80

  config:
    apiUrl: "http://linktree-dev-backend:8000"

  resources:
    limits:
      cpu: 150m
      memory: 192Mi
    requests:
      cpu: 50m
      memory: 64Mi

  autoscaling:
    enabled: false

  # ============================================================================
  # ARGO ROLLOUTS - BLUEGREEN DEPLOYMENT (DEV) - FRONTEND
  # ============================================================================
  # Mesma configuração BlueGreen do backend aplicada ao frontend
  # Frontend e backend podem ser deployados independentemente
  # ============================================================================
  rollout:
    enabled: true
    strategy: blueGreen

    blueGreen:
      scaleDownDelaySeconds: 30
      antiAffinity: false
