# values.yaml - Configuração PROD (Canary)
# Para DEV, use values-dev.yaml com overrides

environment: prod

replicaCount: 3

image:
  repository: ghcr.io/periclesanfe/linktree-backend
  pullPolicy: Always
  tag: "4f49932"

imagePullSecrets: []
  # - name: ghcr-secret

service:
  type: ClusterIP
  port: 8000

appPort: 8000

# Database configuration
database:
  host: linktree-prod-postgresql-rw.prod.svc.cluster.local
  name: "linktree_db"
  port: 5432
  # Credentials vem do secret

# Secret name containing DB_USER, DB_PASSWORD, JWT_SECRET
secretName: "linktree-secrets"

# PostgreSQL subchart (CloudNativePG)
postgresql:
  enabled: true
  environment: production
  cluster:
    name: linktree-prod-postgresql
    instances: 3
    storage:
      size: 10Gi
      storageClass: ""
    bootstrap:
      database: linktree_db
      owner: linktree_prod_user
    resources:
      requests:
        cpu: 500m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi
  credentials:
    secretName: linktree-secrets
    username: linktree_prod_user
    password: prod_password_change_me
    jwtSecret: prod_jwt_secret_change_me
  persistentVolume:
    enabled: true
    name: pv-prod-postgresql-1
    storageClass: ""
    capacity: 10Gi
    reclaimPolicy: Delete
    hostPath: /tmp/pv-prod-postgresql-1

resources:
  requests:
    cpu: 200m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

livenessProbe:
  httpGet:
    path: /api/health
    port: 8000
  initialDelaySeconds: 30
  periodSeconds: 15
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  httpGet:
    path: /api/health
    port: 8000
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3

podAnnotations:
  environment: "production"
  managed-by: "argocd"

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
              - key: app.kubernetes.io/name
                operator: In
                values:
                  - linktree-backend
          topologyKey: kubernetes.io/hostname
