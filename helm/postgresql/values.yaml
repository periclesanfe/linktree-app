# Default values for postgresql chart
# This is a YAML-formatted file.

# Environment name (will be overridden by values.dev.yaml or values.prod.yaml)
environment: development

# PostgreSQL cluster configuration
cluster:
  name: linktree-postgresql
  instances: 1

  storage:
    size: 1Gi
    storageClass: ""  # Use default storage class

  bootstrap:
    database: linktree_db
    owner: linktree_user

  # Resource limits
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

# Secret único contendo credenciais (usado pelo backend também)
# Chaves esperadas: DB_USER, DB_PASSWORD, JWT_SECRET
credentials:
  secretName: linktree-secrets
  username: linktree_user
  password: change_me_in_production
  jwtSecret: change_me_in_production

# Database initialization
initdb:
  enabled: true
  sqlFile: init.sql

# Migration job
# NOTA: Desabilitado temporariamente devido a problemas de autenticação com CloudNativePG
# Execute migrations manualmente: kubectl exec -i linktree-dev-postgresql-1 -n dev -- psql -U postgres -d linktree_db < db-init/init.sql
migration:
  enabled: false
  image: postgres:16-alpine
  restartPolicy: OnFailure
  backoffLimit: 3
